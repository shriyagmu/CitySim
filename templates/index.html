<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Simulation Game</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="text-center">üèôÔ∏è City Simulation Game</h1>
                <p class="text-center text-muted">Build and manage your 5√ó5 city grid</p>
            </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="row mb-3">
                    <div class="col">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endwith %}

        <div class="row">
            <!-- City Grid -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">City Grid</h5>
                    </div>
                    <div class="card-body">
                        <div class="city-grid" id="cityGrid">
                            {% for row_idx in range(5) %}
                                {% for col_idx in range(5) %}
                                    <div class="grid-cell" 
                                         data-row="{{ row_idx }}" 
                                         data-col="{{ col_idx }}"
                                         title="Cell ({{ row_idx }}, {{ col_idx }}): {{ city.get_cell_name(row_idx, col_idx) }}">
                                        <span class="cell-content">{{ city.get_cell_display(row_idx, col_idx) }}</span>
                                        <small class="cell-coords">({{ row_idx }},{{ col_idx }})</small>
                                    </div>
                                {% endfor %}
                            {% endfor %}
                        </div>
                        
                        <!-- Legend -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>Legend:</strong>
                                . = Empty, R = Residential, C = Commercial, I = Industrial, P = Park, 
                                S = School, H = Hospital, E = Power Plant, # = Road
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls and Status -->
            <div class="col-lg-4">
                <!-- City Status -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">City Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="h4 text-primary">{{ city.current_year }}</div>
                                <small class="text-muted">Year</small>
                            </div>
                            <div class="col-4">
                                <div class="h4 text-success">{{ city.population }}</div>
                                <small class="text-muted">Population</small>
                            </div>
                            <div class="col-4">
                                <div class="h4 text-warning">{{ city.happiness }}%</div>
                                <small class="text-muted">Happiness</small>
                            </div>
                        </div>
                        
                        <!-- Progress bars for population and happiness -->
                        <div class="mt-3">
                            <div class="mb-2">
                                <small class="text-muted">Happiness Level</small>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: {{ city.happiness }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Statistics</h5>
                    </div>
                    <div class="card-body">
                        {% set stats = city.get_statistics() %}
                        <div class="row small">
                            <div class="col-6">
                                <div>Residential: {{ stats.residential }}</div>
                                <div>Commercial: {{ stats.commercial }}</div>
                                <div>Industrial: {{ stats.industrial }}</div>
                                <div>Parks: {{ stats.parks }}</div>
                            </div>
                            <div class="col-6">
                                <div>Schools: {{ stats.schools }}</div>
                                <div>Hospitals: {{ stats.hospitals }}</div>
                                <div>Power Plants: {{ stats.power_plants }}</div>
                                <div>Roads: {{ stats.roads }}</div>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <small class="text-muted">Empty Cells: {{ stats.empty_cells }}</small>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Actions</h5>
                    </div>
                    <div class="card-body">
                        <!-- Time Controls -->
                        <form method="POST" action="{{ url_for('advance_time') }}" class="mb-3">
                            <button type="submit" class="btn btn-primary w-100">
                                ‚è≠Ô∏è Advance Year
                            </button>
                        </form>
                        
                        <!-- Reset Button -->
                        <form method="POST" action="{{ url_for('reset_city') }}" class="mb-3">
                            <button type="submit" class="btn btn-outline-danger w-100" 
                                    onclick="return confirm('Are you sure you want to reset the city?')">
                                üóëÔ∏è Reset City
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Selected Cell Info -->
                <div class="card" id="cellInfoCard" style="display: none;">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Cell Actions</h5>
                    </div>
                    <div class="card-body">
                        <div id="cellInfo" class="mb-3">
                            <!-- Cell information will be populated by JavaScript -->
                        </div>
                        
                        <!-- Zone Actions -->
                        <div class="mb-3">
                            <h6>Zone Land:</h6>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="R">Residential</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="C">Commercial</button>
                            </div>
                            <div class="btn-group w-100 mb-3" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="I">Industrial</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="P">Park</button>
                            </div>
                        </div>

                        <!-- Build Actions -->
                        <div class="mb-3">
                            <h6>Build Structure:</h6>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="School">School</button>
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="Hospital">Hospital</button>
                            </div>
                            <div class="btn-group w-100 mb-3" role="group">
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="Power">Power Plant</button>
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="Road">Road</button>
                            </div>
                        </div>

                        <!-- Clear Action -->
                        <button type="button" class="btn btn-outline-warning w-100 mb-2" id="clearCellBtn">
                            Clear Cell
                        </button>

                        <!-- Hidden forms for actions -->
                        <form id="zoneForm" method="POST" action="{{ url_for('zone_land') }}" style="display: none;">
                            <input type="hidden" name="row" id="zoneRow">
                            <input type="hidden" name="col" id="zoneCol">
                            <input type="hidden" name="zone_type" id="zoneType">
                        </form>

                        <form id="buildForm" method="POST" action="{{ url_for('build_structure') }}" style="display: none;">
                            <input type="hidden" name="row" id="buildRow">
                            <input type="hidden" name="col" id="buildCol">
                            <input type="hidden" name="building_type" id="buildingType">
                        </form>

                        <form id="clearForm" method="POST" action="{{ url_for('clear_cell') }}" style="display: none;">
                            <input type="hidden" name="row" id="clearRow">
                            <input type="hidden" name="col" id="clearCol">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='game.js') }}"></script>
</body>
</html>
