<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Simulation Game</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="text-center">üèôÔ∏è City Simulation Game</h1>
                <p class="text-center text-muted">Build and manage your 5√ó5 city grid</p>
            </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="row mb-3">
                    <div class="col">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endwith %}

        <div class="row">
            <!-- City Grid -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">City Grid</h5>
                    </div>
                    <div class="card-body">
                        <div class="city-grid" id="cityGrid">
                            {% for row_idx in range(5) %}
                                {% for col_idx in range(5) %}
                                    <div class="grid-cell" 
                                         data-row="{{ row_idx }}" 
                                         data-col="{{ col_idx }}"
                                         title="Cell ({{ row_idx }}, {{ col_idx }}): {{ city.get_cell_name(row_idx, col_idx) }}">
                                        <span class="cell-content">{{ city.get_cell_display(row_idx, col_idx) }}</span>
                                        <small class="cell-coords">({{ row_idx }},{{ col_idx }})</small>
                                    </div>
                                {% endfor %}
                            {% endfor %}
                        </div>
                        
                        <!-- Legend -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>Legend:</strong><br>
                                . = Empty, R = Residential, C = Commercial, I = Industrial, P = Park<br>
                                S = School, H = Hospital, E = Power Plant, | = Power Line<br>
                                ‚îÄ‚îÇ‚îº = Roads, L = Police, F = Fire, A = Airport, T = Stadium, M = Mall, U = University<br>
                                <strong>Building States:</strong> R/C/I = Empty, r/c/i = Operating, Rd/Cd/Id = Developing, Ra/Ca/Ia = Abandoned
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls and Status -->
            <div class="col-lg-4">
                <!-- City Status -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">City Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-3">
                                <div class="h4 text-primary">{{ city.current_year }}</div>
                                <small class="text-muted">Year</small>
                            </div>
                            <div class="col-3">
                                <div class="h4 text-success">{{ city.population }}</div>
                                <small class="text-muted">Population</small>
                            </div>
                            <div class="col-3">
                                <div class="h4 text-warning">{{ city.happiness }}%</div>
                                <small class="text-muted">Happiness</small>
                            </div>
                            <div class="col-3">
                                <div class="h4 text-info">${{ "%.0f"|format(city.money) }}</div>
                                <small class="text-muted">Budget</small>
                            </div>
                        </div>
                        
                        <!-- Progress bars for population and happiness -->
                        <div class="mt-3">
                            <div class="mb-2">
                                <small class="text-muted">Happiness Level</small>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: {{ city.happiness }}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Economy Info -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>Economy:</strong><br>
                                Monthly Income: ${{ "%.0f"|format(city.income) }}<br>
                                Monthly Expenses: ${{ "%.0f"|format(city.expenses) }}<br>
                                Net: ${{ "%.0f"|format(city.income - city.expenses) }}/month
                            </small>
                        </div>

                        <!-- Advanced Systems Info -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>Advanced Systems:</strong><br>
                                Daily Revenue: ${{ "%.0f"|format(city.daily_revenue) }}<br>
                                Daily Maintenance: ${{ "%.0f"|format(city.daily_maintenance) }}<br>
                                Powered Buildings: {{ city.power_network|length }}<br>
                                Road Network: {{ city.road_network|length }} tiles<br>
                                Active Disasters: {{ city.disasters|length }}
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Statistics</h5>
                    </div>
                    <div class="card-body">
                        {% set stats = city.get_statistics() %}
                        <div class="row small">
                            <div class="col-6">
                                <div>Residential: {{ stats.residential }}</div>
                                <div>Commercial: {{ stats.commercial }}</div>
                                <div>Industrial: {{ stats.industrial }}</div>
                                <div>Parks: {{ stats.parks }}</div>
                                <div>Schools: {{ stats.schools }}</div>
                                <div>Hospitals: {{ stats.hospitals }}</div>
                            </div>
                            <div class="col-6">
                                <div>Power Plants: {{ stats.power_plants }}</div>
                                <div>Roads: {{ stats.roads }}</div>
                                <div>Police: {{ stats.police_stations }}</div>
                                <div>Fire: {{ stats.fire_stations }}</div>
                                <div>Malls: {{ stats.malls }}</div>
                                <div>Stadiums: {{ stats.stadiums }}</div>
                            </div>
                        </div>
                        <div class="row small mt-2">
                            <div class="col-12 text-center">
                                <div>Universities: {{ stats.universities }} | Airports: {{ stats.airports }}</div>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <small class="text-muted">Empty Cells: {{ stats.empty_cells }}</small>
                        </div>
                    </div>
                </div>

                <!-- Active Events -->
                {% if city.get_active_events() %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Active Events</h5>
                    </div>
                    <div class="card-body">
                        {% for event in city.get_active_events() %}
                        <div class="alert alert-info alert-sm mb-2">
                            <strong>{{ event.name }}</strong><br>
                            <small>{{ event.description }}</small>
                            {% if event.get('remaining_duration') %}
                            <br><small class="text-muted">Duration: {{ event.remaining_duration }} months</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Recent Events -->
                {% if city.event_history %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Events</h5>
                    </div>
                    <div class="card-body">
                        {% for event in city.event_history[-5:] %}
                        <div class="small mb-1">
                            <span class="badge bg-{{ 'success' if event.type == 'positive' else 'danger' if event.type == 'disaster' else 'warning' }}">
                                {{ event.name }}
                            </span>
                            <span class="text-muted">(Year {{ event.year }})</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Achievements -->
                {% if city.get_recent_achievements() %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">üèÜ Recent Achievements</h5>
                    </div>
                    <div class="card-body">
                        {% for achievement in city.get_recent_achievements() %}
                        <div class="alert alert-success alert-sm mb-2">
                            <strong>{{ achievement.icon }} {{ achievement.name }}</strong><br>
                            <small>{{ achievement.description }}</small>
                            <br><small class="text-muted">Unlocked in Year {{ achievement.year }}</small>
                        </div>
                        {% endfor %}
                        <div class="text-center">
                            <small class="text-muted">Total: {{ city.achievements|length }} achievements unlocked</small>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Action Buttons -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Actions</h5>
                    </div>
                    <div class="card-body">
                        <!-- Time Controls -->
                        <form method="POST" action="{{ url_for('advance_time') }}" class="mb-3">
                            <button type="submit" class="btn btn-primary w-100">
                                ‚è≠Ô∏è Advance Year
                            </button>
                        </form>
                        
                        <!-- Event Trigger Button -->
                        <form method="POST" action="{{ url_for('trigger_event') }}" class="mb-3">
                            <button type="submit" class="btn btn-outline-warning w-100">
                                üé≤ Trigger Event
                            </button>
                        </form>
                        
                        <!-- Save/Load Section -->
                        <div class="mb-3">
                            <h6>Save/Load:</h6>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control form-control-sm" id="saveName" placeholder="City name" value="My City">
                                <button type="button" class="btn btn-outline-success btn-sm" onclick="saveCity()">üíæ Save</button>
                            </div>
                            <div class="input-group">
                                <select class="form-select form-select-sm" id="loadSelect">
                                    <option value="">Select save file...</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="loadCity()">üìÅ Load</button>
                            </div>
                        </div>
                        
                        <!-- Reset Button -->
                        <form method="POST" action="{{ url_for('reset_city') }}" class="mb-3">
                            <button type="submit" class="btn btn-outline-danger w-100" 
                                    onclick="return confirm('Are you sure you want to reset the city?')">
                                üóëÔ∏è Reset City
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Selected Cell Info -->
                <div class="card" id="cellInfoCard" style="display: none;">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Cell Actions</h5>
                    </div>
                    <div class="card-body">
                        <div id="cellInfo" class="mb-3">
                            <!-- Cell information will be populated by JavaScript -->
                        </div>
                        
                        <!-- Zone Actions -->
                        <div class="mb-3">
                            <h6>Zone Land:</h6>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="R" title="Cost: $500">Residential ($500)</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="C" title="Cost: $800">Commercial ($800)</button>
                            </div>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="I" title="Cost: $1000">Industrial ($1000)</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm zone-btn" data-zone="P" title="Cost: $300">Park ($300)</button>
                            </div>
                            
                            <!-- 2x2 Block Zoning -->
                            <div class="mt-2">
                                <h6>Zone 2x2 Block:</h6>
                                <div class="btn-group w-100 mb-2" role="group">
                                    <button type="button" class="btn btn-outline-primary btn-sm zone-2x2-btn" data-zone="R" title="Cost: $2000">2x2 Residential ($2000)</button>
                                    <button type="button" class="btn btn-outline-primary btn-sm zone-2x2-btn" data-zone="C" title="Cost: $3200">2x2 Commercial ($3200)</button>
                                </div>
                                <div class="btn-group w-100 mb-3" role="group">
                                    <button type="button" class="btn btn-outline-primary btn-sm zone-2x2-btn" data-zone="I" title="Cost: $4000">2x2 Industrial ($4000)</button>
                                </div>
                            </div>
                        </div>

                        <!-- Infrastructure -->
                        <div class="mb-3">
                            <h6>Infrastructure:</h6>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-dark btn-sm road-btn" title="Cost: $200">üõ£Ô∏è Road ($200)</button>
                                <button type="button" class="btn btn-outline-warning btn-sm power-line-btn" title="Cost: $100">‚ö° Power Line ($100)</button>
                            </div>
                        </div>

                        <!-- Build Actions -->
                        <div class="mb-3">
                            <h6>Build Structure:</h6>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="School" title="Cost: $2000">School ($2000)</button>
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="Hospital" title="Cost: $3000">Hospital ($3000)</button>
                            </div>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-info btn-sm build-btn" data-building="Power" title="Cost: $2500">Power Plant ($2500)</button>
                            </div>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-warning btn-sm build-btn" data-building="Police" title="Cost: $4000">Police ($4000)</button>
                                <button type="button" class="btn btn-outline-warning btn-sm build-btn" data-building="Fire" title="Cost: $3500">Fire ($3500)</button>
                            </div>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-success btn-sm build-btn" data-building="Mall" title="Cost: $6000">Mall ($6000)</button>
                                <button type="button" class="btn btn-outline-success btn-sm build-btn" data-building="Stadium" title="Cost: $8000">Stadium ($8000)</button>
                            </div>
                            <div class="btn-group w-100 mb-3" role="group">
                                <button type="button" class="btn btn-outline-danger btn-sm build-btn" data-building="University" title="Cost: $10000">University ($10000)</button>
                                <button type="button" class="btn btn-outline-danger btn-sm build-btn" data-building="Airport" title="Cost: $15000">Airport ($15000)</button>
                            </div>
                        </div>

                        <!-- Disaster Actions -->
                        <div class="mb-3">
                            <h6>Disasters (Testing):</h6>
                            <div class="btn-group w-100 mb-2" role="group">
                                <button type="button" class="btn btn-outline-danger btn-sm disaster-btn" data-disaster="fire" title="Trigger fire disaster">üî• Fire</button>
                                <button type="button" class="btn btn-outline-danger btn-sm disaster-btn" data-disaster="tornado" title="Trigger tornado disaster">üå™Ô∏è Tornado</button>
                            </div>
                        </div>

                        <!-- System Controls -->
                        <div class="mb-3">
                            <h6>System Controls:</h6>
                            <form method="POST" action="{{ url_for('update_systems') }}" class="mb-2">
                                <button type="submit" class="btn btn-outline-info btn-sm w-100">üîÑ Update Systems</button>
                            </form>
                        </div>

                        <!-- Clear Action -->
                        <button type="button" class="btn btn-outline-warning w-100 mb-2" id="clearCellBtn">
                            Clear Cell
                        </button>

                        <!-- Hidden forms for actions -->
                        <form id="zoneForm" method="POST" action="{{ url_for('zone_land') }}" style="display: none;">
                            <input type="hidden" name="row" id="zoneRow">
                            <input type="hidden" name="col" id="zoneCol">
                            <input type="hidden" name="zone_type" id="zoneType">
                        </form>

                        <form id="zone2x2Form" method="POST" action="{{ url_for('zone_2x2_block') }}" style="display: none;">
                            <input type="hidden" name="row" id="zone2x2Row">
                            <input type="hidden" name="col" id="zone2x2Col">
                            <input type="hidden" name="zone_type" id="zone2x2Type">
                        </form>

                        <form id="buildForm" method="POST" action="{{ url_for('build_structure') }}" style="display: none;">
                            <input type="hidden" name="row" id="buildRow">
                            <input type="hidden" name="col" id="buildCol">
                            <input type="hidden" name="building_type" id="buildingType">
                        </form>

                        <form id="roadForm" method="POST" action="{{ url_for('build_road_tile') }}" style="display: none;">
                            <input type="hidden" name="row" id="roadRow">
                            <input type="hidden" name="col" id="roadCol">
                        </form>

                        <form id="powerLineForm" method="POST" action="{{ url_for('build_power_line') }}" style="display: none;">
                            <input type="hidden" name="row" id="powerLineRow">
                            <input type="hidden" name="col" id="powerLineCol">
                        </form>

                        <form id="disasterForm" method="POST" action="{{ url_for('trigger_disaster') }}" style="display: none;">
                            <input type="hidden" name="row" id="disasterRow">
                            <input type="hidden" name="col" id="disasterCol">
                            <input type="hidden" name="disaster_type" id="disasterType">
                        </form>

                        <form id="clearForm" method="POST" action="{{ url_for('clear_cell') }}" style="display: none;">
                            <input type="hidden" name="row" id="clearRow">
                            <input type="hidden" name="col" id="clearCol">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='game.js') }}"></script>
</body>
</html>
